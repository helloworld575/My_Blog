{% extends 'base.html' %}

{% load staticfiles %}
{% load thumbnail %}

{% block title %}全部图片{% endblock %}

{% block cssfiles %}
<style type="text/css">
.container-fluid {
  padding: 20px;
  }
.box {
    background-color: white;
    box-shadow: 2px 2px 2px #888888;
    border-radius: 5px;
    margin-bottom: 20px;
    margin-left: 20px;
    float: left;
    width: 200px;
  }
  .box img {
  max-width: 100%
}
</style>
{% endblock %}

{% block content %}
<div id="masonry" class="container-fluid">
    {% for image in images %}
          <div class="box text-center">
          <a href="javascript:void(0)" onclick="get_img('{{ image.image.url }}','{{ image.user }}','{{ image.title }}','{{ image.description }}','{{ image.url }}')">
              {% thumbnail image.image "200" as im %}
              <img src="{{ im.url }}" alt="{{ image.description }}">
              {% endthumbnail %}
          <p>{{ image.title }}</p>
          </a>
          </div>
    {% endfor %}
</div>
    {% include 'paginator.html' %}
{% endblock %}

{% block javascript %}
    <script src="http://jq22.qiniudn.com/masonry-docs.min.js"></script>
    <script src="{% static 'js/layer.js' %}" type="text/javascript"></script>
    <script>
$(function() {
    var $container = $('#masonry');
    $container.imagesLoaded(function() {
        $container.masonry({
                itemSelector: '.box',
                gutter: 20,
                isAnimated: true,
            });
     });
});
function get_img(img_url,username,title,desc,o_url) {
    layer.open({
        type:1,
        skin:'layui-layer-rim',
        closeBtn:0,
        shift:2,
        shadeClose:true,
        title:"图片详细信息",
        area:['800px','800px'],
        content:'<div class="text-center"><div id="this_img" style="height:600px;"><img src=\"{% static "img/load.gif" %}\"/></div><div id="msg" class="text-center"><p>上传者：'+username+'</p><p>图片名称：'+title+'</p><p>图片描述：'+desc+'</p><p><a href="'+o_url+'">图片原地址</a></p></div></div>'
    });
    var xhr = new XMLHttpRequest();
            xhr.open('GET', img_url, true);
            xhr.responseType = "blob";
            xhr.onload = function() {
                if (this.status == 200) {
                    var blob = this.response;
                    var img = document.createElement("img");
                    img.onload = function(e) {
                        window.URL.revokeObjectURL(img.src);
                    };
                    img.src = window.URL.createObjectURL(blob);
                    img.id="image";
                    $("#this_img").html(img);
                    $("#image").attr({"height":"600px"});
                }
            };
            xhr.send();
}
    </script>
{% endblock %}